{% extends 'base.html' %}
{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <title>GA</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

  <script src="https://code.highcharts.com/highcharts.src.js"></script>

  <script src="https://code.jquery.com/jquery-3.1.0.min.js"></script>
  <script src='https://code.jquery.com/jquery-3.2.1.min.js'></script>



  <style>
  .fakeimg {
    height: 200px;
    background: #aaa;
  }
</style>

<link rel="shortcut icon" href="https://docs.google.com/uc?id=1h8jgyPDlDWWinD_VP50nqKXnmdCHEKH3" type="image/x-icon" />

</head>
<body>

  <nav class="navbar navbar-expand-sm bg-info navbar-light" style="background-color: #e6e6e6;">
  <ul class="navbar-nav">
    <li class="nav-item active">
      <a class="nav-link" href="#"></a>
    </li>
    <li class="nav-item">
      <a class="nav-link" href="#"></a>
    </li>
    <li class="nav-item">
      <a class="nav-link" href="#"></a>
    </li>
    <li class="nav-item">
      <a class="nav-link disabled" href="#"></a>
    </li>
  </ul>
</nav>

  <div class="" style="background-color: #e6e6e6;">
    <div class="row">
      
      <div class="col-sm-3">
        <img src="{% static "gerencia-administrativa/logo_pezinho.png" %}" alt="" width="50%">
        <!--
        <img src="https://docs.google.com/uc?id=1gDXBrx2Nq6k_Whfk6E4IpkvcyDypJPxY" alt="" width="50%">
      -->
      </div>
      <div class="col-sm-4" style="margin-top: 10px; text-align: center;">
        <h4>SECRETARIA DE ESTADO DA SAÚDE</h4>
        <h6>GERÊNCIA ADMINISTRATIVA</h6>
        <h6><b>----</b></h6>
      </div>
      <div class="col-sm-3">
        <img src="{% static "gerencia-administrativa/nova-marca-governo-01.png" %}" alt="" width="50%">
        <!--
        <img src="https://docs.google.com/uc?id=1tLThSsCUOFKg-1fphY-Y9hrC_XFnHdOr" alt="" width="50%">
      -->
      </div>
    </div>
  </div>

  <nav class="navbar navbar-expand-sm bg-secondary navbar-dark">
    <a class="navbar-brand" href="#"></a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#collapsibleNavbar">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="collapsibleNavbar">
      <ul class="navbar-nav">
        <li class="nav-item">
          <a class="nav-link" href="/index/">Home</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/localizar_fichas/">Pesquisar por Unidade</a>
        </li>
        <li class="nav-item">
          <a class="nav-link active" href="">Acompanhar Ficha</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/informar_dados_ficha/">Informar Dados de Ficha</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/logout/">Sair</a>
        </li>    
      </ul>
    </div>
    <div>
      <b style="color: white;">Logged: </b><i style="color: white;">{{user.get_username}}</i>
    </div>  
  </nav>
{% block content %}
  <div class="container-lx mt-3 border" style="margin-top:30px; background-color: ;" id="container">
    <div class="row">
      <div class="col-sm-12">
        <div class="alert alert-primary" style="text-align: center;">
          <strong style="align-items: center;">Resultado - {{unidade}}</strong>
        </div>
      </div>
    </div>
    <hr>

    <div class="row">
      <div class="col-md-12">
        
        <table id="userTable" class="table table-hover">
          <tr>
            
            <th style="font-size: 80%;">Matrícula</th>
            <th style="font-size: 80%;">Nome</th>
            <th style="font-size: 80%;">Recebido</th>
            <th style="font-size: 80%;">Data</th>
            <th style="font-size: 80%;">Conferido</th>
            <th style="font-size: 80%;">Data</th>
            <th style="font-size: 80%;">Encaminhado SEAD</th>
            <th style="font-size: 80%;">Data</th>
            <th style="font-size: 80%;">Ofício</th>
            <th style="font-size: 80%;">Devolução</th>
            <th style="font-size: 80%;">Data Devolução</th>
            <th style="font-size: 80%;">Gabinete</th>
            <th style="font-size: 80%;">Data</th>            
            <th style="text-align: center; font-size: 80%;">Ações</th>
          </tr>
          {% if servidores %}
          {% for gerencia in servidores %}
          <tr>
              
              <td class="editable" data-id="{{gerencia.id}}" data-type="matricula" style="font-size: 80%;">{{gerencia.matricula}}</td>
              <td class="editable" data-id="{{gerencia.id}}" data-type="nome" style="font-size: 80%;">{{gerencia.nome}}</td>
              <td class="editable" data-id="{{gerencia.id}}" data-type="status_recebido" style="font-size: 80%;">{{gerencia.status_recebido}}</td>
              <td class="editable" data-id="{{gerencia.id}}" data-type="data_status_recebido" style="font-size: 80%;">
                {% if gerencia.data_status_recebido %}
                {{gerencia.data_status_recebido}}</td>
                {% else %}

                {%endif%}
              <td class="editable" data-id="{{gerencia.id}}" data-type="status_conferido" style="font-size: 80%;">
              {% if gerencia.status_conferido %}{{gerencia.status_conferido}}{%else%}{%endif%}</td>
              <td class="editable" data-id="{{gerencia.id}}" data-type="data_status_conferido" style="font-size: 80%;">{{gerencia.data_status_conferido}}</td>
              <td class="editable" data-id="{{gerencia.id}}" data-type="status_encaminhado_sead" style="font-size: 80%;">{{gerencia.status_encaminhado_sead}}</td>
              
              <td class="editable" data-id="{{gerencia.id}}" data-type="data_status_encaminhado_sead" style="font-size: 80%;">{{gerencia.data_status_encaminhado_sead}}</td>
              
              <td class="editable" data-id="{{gerencia.id}}" data-type="num_oficio_encaminhado_sead" style="font-size: 80%;">{{gerencia.num_oficio_encaminhado_sead}}</td>

              <td class="editable" data-id="{{gerencia.id}}" data-type="status_devolucao" style="font-size: 80%;">{{gerencia.status_devolucao}}</td>

              <td class="editable" data-id="{{gerencia.id}}" data-type="data_status_devolucao" style="font-size: 80%;">{{gerencia.data_status_devolucao}}</td>
              <td class="editable" data-id="{{gerencia.id}}" data-type="status_encaminhado_gabinete" style="font-size: 80%;">{{gerencia.status_encaminhado_gabinete}}</td>

              <td class="editable" data-id="{{gerencia.id}}" data-type="data_status_encaminhado_gabinete" style="font-size: 80%;">{{gerencia.data_status_encaminhado_gabinete}}</td>

              <!--
              <td align="center">
                  <button class="btn btn-success form-control" onClick="editGerencia({{gerencia.id}})" data-toggle="modal" data-target="#myModal")">Editar</button>
              </td>
              -->
              <td align="center">
                  <button class="btn btn-info btn-sm" onClick="window.location.reload();">Atualizar</button>
              </td>
          </tr>
          {% endfor %}
          {% else %}
          
          {% endif %}
        </table>
      </div>
    </div>

  </div>

<!--Script de mascara-->

  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/css/bootstrap.min.css">

  <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.6/umd/popper.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/js/bootstrap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.mask/1.14.15/jquery.mask.min.js"></script>

  
  <!-- endscript-->

  <script>
    $(document).ready(function($) {
      $('#form-data_encaminhado').mask('00-00-0000');
      $('#form-data_recebido').mask('00-00-0000');
      $('#form-data_conferido').mask('00-00-0000');
      $('#form-data_devolvido').mask('00-00-0000');
      $('#form-data_gabinete').mask('00-00-0000');
    });

    $(document).ready(function($){
      $("#lb_check_encaminhado").click(function(){
        $("#form-status_encaminhado").val("Encaminhado");
      });
    });

    $(document).ready(function($){
      $("#lb_check_recebido").click(function(){
        $("#form-status_recebido").val("Recebido");
      });
    });

    $(document).ready(function($){
      $("#lb_check_conferido").click(function(){
        $("#form-status_conferido").val("Conferido");
      });
    });

    $(document).ready(function($){
      $("#lb_check_devolvido").click(function(){
        $("#form-status_devolvido").val("Devolvido");
      });
    });

    $(document).ready(function($){
      $("#lb_check_gabinete").click(function(){
        $("#form-status_gabinete").val("Gabinete");
      });
    });


    $(function() {
    $(document).on('click','#lb_check_recebido', function (e) {
      if ($(this).is(":checked")) {
        //$("#lb_data_recebido_id").show();
      } else {
        //$("#form-status_recebido").hide();
        $("#form-status_recebido").val("");
        $("#form-data_recebido").val("");
      }
    });
  });

    $(function() {
    $(document).on('click','#lb_check_conferido', function (e) {
      if ($(this).is(":checked")) {
        //$("#lb_data_recebido_id").show();
      } else {
        //$("#form-status_recebido").hide();
        $("#form-status_conferido").val("");
        $("#form-data_conferido").val("");
      }
    });
  });

    $(function() {
    $(document).on('click','#lb_check_encaminhado', function (e) {
      if ($(this).is(":checked")) {
        //$("#lb_data_recebido_id").show();
      } else {
        //$("#form-status_recebido").hide();
        $("#form-status_encaminhado").val("");
        $("#form-data_encaminhado").val("");
        $("#form-num_oficio").val("");
      }
    });
  });

    $(function() {
    $(document).on('click','#lb_check_devolvido', function (e) {
      if ($(this).is(":checked")) {
        //$("#lb_data_recebido_id").show();
      } else {
        //$("#form-status_recebido").hide();
        $("#form-status_devolvido").val("");
        $("#form-data_devolvido").val("");
        //$("#form-num_oficio").val("");
      }
    });
  });

    $(function() {
    $(document).on('click','#lb_check_gabinete', function (e) {
      if ($(this).is(":checked")) {
        //$("#lb_data_recebido_id").show();
      } else {
        //$("#form-status_recebido").hide();
        $("#form-status_gabinete").val("");
        $("#form-data_gabinete").val("");
        //$("#form-num_oficio").val("");
      }
    });
  });


  </script>


{% endblock %}

  <div style="height: 350px;"></div>

  <div class="jumbotron text-center" style="margin-bottom:0">
    <p>Footer</p>
    <i class="fa">&#xf1f9;</i>
  </div>
  <br>
  {% block javascript %}
  <script>

    $(document).ready(function(){
      $(document).on("dblclick", ".editable",function(){
        var value=$(this).text();
        var input="<input type='text' class='input-data' value='"+value+"' class='form-control'>";
        $(this).html(input);
        $(this).removeClass("editable")
      });

      $(document).on("blur",".input-data",function(){
        var value=$(this).val();
        var td=$(this).parent("td");
        $(this).remove();
        td.html(value);
        td.addClass("editable");
        var type=td.data("type");
        sendToServer(td.data("id"),value,type);
      });

      $(document).on("keypress",".input-data",function(e){
        var key=e.which;
        if (key==13){
          var value=$(this).val();
          var td=$(this).parent("td");
          $(this).remove();
          td.html(value);
          td.addClass("editable");
          var type=td.data("type");
          sendToServer(td.data("id"),value,type);

        }

      });

      function sendToServer(id,value,type){
        console.log(id);
        console.log(value);
        console.log(type);
        $.ajax({
          url:"update_servidor",
          type:"POST",
          data:{id:id,type:type,value:value},
        })
        .done(function(response){
          console.log(response);
        })
        .fail(function(){
          console.log("Ocorreu Erro");
        });
      }

    });

  </script>
  {% endblock javascript %}

</body>
</html>